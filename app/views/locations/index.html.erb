<!-- Google map library files -->
<%= javascript_include_tag "http://maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" %>
<%= javascript_include_tag "http://google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" %>

<!-- Google map div -->
<div style='width: 800px;'>
  <div id="feed_map" style='width: 1200px; height: 600px;'></div>
</div>
    


<script>
var flightPlanCoordinates = [
  <% @location_hash.each do |location| %>
    new google.maps.LatLng(<%= location[:lat]%>, <%= location[:lng]%>),
  <%end%>
  ];
// method to call to create map
function initialize(){
  var mapOptions = {
    zoom: 3,
    center: new google.maps.LatLng(0, -180),
    mapTypeId: google.maps.MapTypeId.DRIVING
  };
  var flightPath = new google.maps.Polyline({
    path: flightPlanCoordinates,
    geodesic: true,
    strokeColor: '#FF0000',
    strokeOpacity: 1.0,
    strokeWeight: 2
  });

	var handler = Gmaps.build('Google');
	  handler.buildMap({ provider: {}, internal: {id: 'feed_map'}}, function(){
	  markers = handler.addMarkers(<%=raw @location_hash.to_json %>);
	  handler.bounds.extendWith(markers);
	  handler.fitMapToBounds();
    flightPath.setMap(handler.getMap());
	});
}

google.maps.event.addDomListener(window, "load", initialize);

</script>
