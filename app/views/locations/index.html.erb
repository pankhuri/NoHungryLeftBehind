<!-- Google map library files -->
<%= javascript_include_tag "http://maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" %>
<%= javascript_include_tag "http://google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js" %>

<!-- Google map div -->
<div style='width: 800px;'>
  <div id="feed_map" style='width: 1200px; height: 600px;'></div>
</div>
    


<script>
// method to call to create map
var directionsDisplay = new google.maps.DirectionsRenderer();
var directionsService = new google.maps.DirectionsService();
function calcRoute(latitude_origin,longitude_origin,latitude_destination,latitude_destination) {
  var origin      = new google.maps.LatLng(latitude_origin, longitude_origin);
  var destination = new google.maps.LatLng(latitude_destination, latitude_destination);
  var request = {
      origin:      origin,
      destination: destination,
      travelMode:  google.maps.TravelMode.DRIVING
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });
}

		<%= @location_hash.each_slice(2) do |location_hash|%>
				calcRoute(<%=location_hash.first[:lat]%>,<%=location_hash.first[:lng]%>,<%=location_hash.last[:lat]%>,<%=location_hash.last[:lng]%>);
		<%end%>

function initialize(){

	var handler = Gmaps.build('Google');
	  handler.buildMap({ provider: {}, internal: {id: 'feed_map'}}, function(){
	  markers = handler.addMarkers(<%=raw @location_hash.to_json %>);
	  handler.bounds.extendWith(markers);
	  handler.fitMapToBounds();
	  directionsDisplay.setMap(handler.getMap());
	});
}

google.maps.event.addDomListener(window, "load", initialize);

</script>